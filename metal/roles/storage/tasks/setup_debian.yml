---
- name: Upgrade packages
  apt:
    update_cache: true
    upgrade: dist
  when: upgrade_packages

- name: Ensure base packages
  apt:
    name:
      # base utils
      - xz-utils
      # hardware monitoring
      - lm-sensors
      # nfs
      - nfs-kernel-server
      - nfs-common
    state: present
    update_cache: true

- name: Install mergerfs
  apt:
    deb: "{{ mergerfs_url_deb }}"
    state: present

- name: Copy snapraid .deb
  copy:
    src: files/snapraid_{{ snapraid_version }}_{{ ansible_distribution_release }}.deb
    dest: /tmp/
    owner: root
    group: root
    mode: "0755"

- name: Install snapraid
  apt:
    deb: /tmp/snapraid_{{ snapraid_version }}_{{ ansible_distribution_release }}.deb
    state: present
